# MemoQ工单系统产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品背景

MemoQ工单系统是一个专为MemoQ公司设计的客户支持工单管理平台，旨在提供高效、透明的客户服务体验。系统支持多角色协作，包括系统管理员、技术支持管理员、技术支持人员和客户用户，实现工单全生命周期的管理、追踪和分析。

### 1.2 产品目标

- 提供统一的工单提交、跟踪和管理平台
- 支持多种登录方式和公司专属定制
- 实现工单分配、转移和协作处理
- 提供SLA监控和工单状态追踪
- 支持工单类型分类和标签管理
- 实现邮件通知和Webhook集成
- 提供数据分析和报表功能

### 1.3 用户角色

1. **系统管理员 (System Admin)**：拥有最高权限，可管理所有系统配置和用户
2. **技术支持管理员 (Technical Support Admin)**：管理技术支持团队、公司账户和工单分配
3. **技术支持人员 (Support)**：处理和回复工单，与客户沟通
4. **客户用户 (Customer)**：提交和跟进工单，查看公司内工单

## 2. 功能需求

### 2.1 用户认证与权限管理

#### 2.1.1 统一登录入口

- 系统提供统一的登录页面，支持所有角色登录
- 根据用户角色自动跳转到相应的Dashboard
- 支持记住登录状态和安全退出

#### 2.1.2 多种登录方式

- 用户名密码登录（所有角色）
- 飞书单点登录（客户用户）
- 微信登录（客户用户）
- 企业微信登录（客户用户）
- 邮箱登录（客户用户）

#### 2.1.3 公司专属登录页面

- 每个公司拥有专属的登录URL
- 登录页面显示MemoQ Logo和公司Logo（如已上传）
- 登录页面支持自定义背景图片
- 仅显示该公司配置的登录方式

#### 2.1.4 权限控制

- 系统管理员：管理所有用户、公司和系统配置
- 技术支持管理员：管理技术支持人员、公司配置和工单分配
- 技术支持人员：处理分配的工单和回复客户
- 客户用户：提交和跟进工单，查看公司内工单

### 2.2 公司管理

#### 2.2.1 公司信息管理

- 创建、编辑和删除公司账户
- 配置公司基本信息（名称、联系人、联系方式等）
- 上传公司Logo和登录页背景图
- 生成公司专属工单提交URL

#### 2.2.2 公司SSO配置

- 配置公司支持的单点登录方式
- 设置各登录方式的应用ID和密钥
- 测试SSO配置的有效性

#### 2.2.3 公司SLA配置

- 设置工单响应时间SLA
- 设置工单解决时间SLA
- 配置工单闲置超时时间
- 设置SLA优先级规则

#### 2.2.4 公司邮件配置

- 配置SMTP服务器信息
- 设置发件人邮箱和名称
- 配置邮件通知触发条件
- 测试邮件发送功能

#### 2.2.5 公司Webhook配置

- 添加Webhook URL和事件类型
- 配置Webhook请求头和认证信息
- 测试Webhook有效性
- 查看Webhook调用历史

### 2.3 用户管理

#### 2.3.1 系统用户管理

- 创建和管理系统管理员账号
- 创建和管理技术支持管理员账号
- 查看和搜索所有用户

#### 2.3.2 技术支持人员管理

- 创建和管理技术支持人员账号
- 分配技术支持人员到公司
- 重置技术支持人员密码
- 查看技术支持人员工作负载

#### 2.3.3 客户用户管理

- 创建和管理客户用户账号
- 关联客户用户到公司
- 重置客户用户密码
- 导入/导出客户用户数据

### 2.4 工单管理

#### 2.4.1 工单创建

- 客户用户创建工单
- 技术支持人员代客户创建工单
- 支持附件上传
- 选择工单类型和紧急度
- 添加工单关注人

#### 2.4.2 工单分配

- 技术支持管理员分配工单给技术支持人员
- 自动分配规则（可选）
- 工单转移给其他技术支持人员
- 记录工单转移历史和原因

#### 2.4.3 工单处理

- 技术支持人员回复工单
- 添加内部备注（客户不可见）
- 更新工单状态
- 上传附件
- 暂停/恢复工单处理

#### 2.4.4 工单状态流转

- 新建工单 → 待分配 → 处理中 → 等待客户回复 → 客户已回复 → 已解决 → 已关闭
- 支持在任意状态暂停工单
- 记录状态变更历史和原因

#### 2.4.5 工单类型树

- 支持多级工单类型结构
- 管理员可创建和编辑工单类型
- 客户创建工单时选择类型
- 技术支持可修改工单类型

#### 2.4.6 工单标签系统

- 创建和管理工单标签
- 为工单添加多个标签
- 根据标签筛选和分类工单
- 标签支持自定义颜色

#### 2.4.7 工单关注功能

- 客户用户可关注公司内其他工单
- 关注工单后接收通知和更新
- 查看"我关注的工单"列表
- 取消关注工单

#### 2.4.8 工单URL生成

- 为每个工单生成唯一URL（格式：/companyname/xxxx）
- 通过URL直接访问工单详情
- 支持生成工单二维码

### 2.5 Dashboard与报表

#### 2.5.1 系统管理员Dashboard

- 系统概览统计（用户数、公司数、工单数等）
- 活跃工单监控
- 系统健康状态
- 用户活跃度分析

#### 2.5.2 技术支持管理员Dashboard

- 待分配工单表格
- 即将Miss IR和已Miss IR工单表格
- 即将Idle和已Idle工单表格
- 技术支持人员工作负载统计
- 工单处理效率分析

#### 2.5.3 技术支持Dashboard

- 我的工单列表
- 待处理工单优先级排序
- 工单处理进度追踪
- 个人工作效率统计

#### 2.5.4 客户用户Dashboard

- 我的活跃工单
- 需要我关注的工单
- 公司所有工单列表
- 工单状态分布统计

#### 2.5.5 报表与分析

- 工单处理时间分析
- SLA达成率报表
- 工单类型分布分析
- 客户满意度统计
- 自定义报表生成

### 2.6 通知与集成

#### 2.6.1 邮件通知

- 工单创建通知
- 工单状态变更通知
- 新回复通知
- 工单分配通知
- 支持自定义邮件模板

#### 2.6.2 Webhook集成

- 工单事件Webhook（创建、更新、回复、关闭等）
- 自定义Webhook请求格式
- Webhook调用日志和重试机制
- 测试Webhook功能

#### 2.6.3 系统内通知

- 未读工单提醒
- SLA即将超时提醒
- 工单状态变更提醒
- 新回复提醒

### 2.7 系统配置

#### 2.7.1 全局设置

- 系统名称和Logo配置
- 默认语言和时区设置
- 默认工单配置
- 系统邮件模板

#### 2.7.2 安全设置

- 密码策略配置
- 登录尝试限制
- 会话超时设置
- 敏感操作日志

## 3. 非功能需求

### 3.1 性能需求

- 页面加载时间不超过3秒
- 支持同时在线用户数不少于1000
- 数据库查询响应时间不超过1秒
- 文件上传支持最大50MB

### 3.2 安全需求

- 所有通信使用HTTPS加密
- 密码存储使用加盐哈希
- 防止SQL注入和XSS攻击
- 敏感数据加密存储
- CSRF防护

### 3.3 可用性需求

- 系统可用性99.9%
- 定期数据备份
- 故障自动恢复机制
- 多浏览器兼容性（Chrome、Firefox、Safari、Edge）

### 3.4 可扩展性需求

- 支持水平扩展
- 模块化架构设计
- API接口标准化
- 支持未来功能扩展

## 4. 用户界面设计

### 4.1 设计原则

- 现代简约风格
- 响应式设计，支持桌面和移动设备
- 一致的色彩和排版系统
- 清晰的视觉层次和导航

### 4.2 关键界面

#### 4.2.1 登录页面

- 品牌展示区（MemoQ Logo和公司Logo）
- 登录表单（用户名/密码）
- 第三方登录选项（根据公司配置）
- 自定义背景图片

#### 4.2.2 Dashboard页面

- 顶部导航栏（用户信息、通知、退出）
- 侧边菜单（功能导航）
- 数据概览卡片
- 工单列表和统计图表

#### 4.2.3 工单详情页面

- 工单基本信息
- 工单状态和进度时间线
- 回复历史记录
- 附件列表
- 操作按钮（回复、转移、暂停等）

#### 4.2.4 工单创建页面

- 工单表单（标题、描述、类型等）
- 工单类型树选择器
- 附件上传区域
- 关注人选择器

#### 4.2.5 管理页面

- 数据表格（用户、公司、工单等）
- 筛选和搜索功能
- 批量操作工具栏
- 创建/编辑表单

## 5. 技术架构

### 5.1 前端技术栈

- Vue.js 3 + Vite
- Vuetify 3 UI框架
- Pinia状态管理
- Vue Router路由管理
- Axios HTTP客户端

### 5.2 后端技术栈

- Django + Django REST Framework
- PostgreSQL数据库
- Redis缓存
- Celery异步任务队列
- JWT认证

### 5.3 部署架构

- Docker容器化部署
- Nginx Web服务器
- HTTPS加密
- 静态资源CDN加速

## 6. 业务流程

### 6.1 工单创建流程

1. 客户用户登录系统
2. 进入工单创建页面
3. 填写工单信息（标题、描述、类型等）
4. 上传附件（可选）
5. 添加关注人（可选）
6. 提交工单
7. 系统创建工单并分配工单号
8. 发送工单创建通知
9. 工单进入待分配状态

### 6.2 工单分配流程

1. 技术支持管理员登录系统
2. 查看待分配工单列表
3. 选择工单并指定技术支持人员
4. 系统更新工单状态为处理中
5. 发送工单分配通知
6. 记录工单分配历史

### 6.3 工单处理流程

1. 技术支持人员登录系统
2. 查看已分配工单列表
3. 打开工单详情页面
4. 分析工单问题
5. 回复客户或添加内部备注
6. 上传附件（可选）
7. 更新工单状态
8. 系统记录回复历史和状态变更

### 6.4 工单转移流程

1. 技术支持人员决定转移工单
2. 打开工单转移对话框
3. 选择转移目标技术支持人员
4. 填写转移原因
5. 确认转移
6. 系统更新工单分配信息
7. 记录工单转移历史
8. 发送工单转移通知

### 6.5 工单暂停流程

1. 技术支持人员或客户用户决定暂停工单
2. 打开工单暂停对话框
3. 填写暂停原因
4. 确认暂停
5. 系统更新工单状态为暂停
6. 暂停SLA和idle计时
7. 记录工单暂停历史
8. 发送工单暂停通知

### 6.6 工单关闭流程

1. 技术支持人员解决工单问题
2. 更新工单状态为已解决
3. 客户确认问题已解决
4. 技术支持人员或客户关闭工单
5. 填写关闭原因和满意度评价
6. 系统更新工单状态为已关闭
7. 记录工单关闭历史
8. 发送工单关闭通知

## 7. 数据模型

### 7.1 用户模型 (User)

- id: 唯一标识符
- username: 用户名
- email: 电子邮箱
- password: 密码（加密存储）
- first_name: 名
- last_name: 姓
- phone: 电话号码
- wechat_id: 微信ID
- feishu_id: 飞书ID
- enterprise_wechat_id: 企业微信ID
- company: 关联的公司
- role: 用户角色（系统管理员、技术支持管理员、技术支持人员、客户用户）
- is_active: 是否激活
- date_joined: 注册时间

### 7.2 公司模型 (Company)

- id: 唯一标识符
- name: 公司名称
- code: 公司代码
- contact_person: 联系人
- contact_email: 联系邮箱
- contact_phone: 联系电话
- is_active: 是否激活
- logo: 公司Logo
- login_background: 登录页背景图
- products: 使用的产品
- importance: 重要性级别
- sso_configs: SSO配置（JSON字段）
- email_config: 邮件配置（JSON字段）
- ticket_submission_url_slug: 工单提交URL标识
- created_at: 创建时间
- updated_at: 更新时间

### 7.3 公司配置模型 (CompanyConfig)

- id: 唯一标识符
- company: 关联的公司
- sla_level: SLA级别
- priority_level: 优先级级别
- idle_timeout_minutes: 闲置超时时间（分钟）
- sla_response_minutes: SLA响应时间（分钟）
- sla_resolution_minutes: SLA解决时间（分钟）
- created_at: 创建时间
- updated_at: 更新时间

### 7.4 工单类型模型 (TicketType)

- id: 唯一标识符
- name: 类型名称
- description: 类型描述
- parent: 父类型（树状结构）
- created_by: 创建者
- is_active: 是否激活
- created_at: 创建时间
- updated_at: 更新时间

### 7.5 工单标签模型 (TicketLabel)

- id: 唯一标识符
- name: 标签名称
- color: 标签颜色
- description: 标签描述
- created_at: 创建时间
- updated_at: 更新时间

### 7.6 工单模型 (Ticket)

- id: 唯一标识符
- title: 工单标题
- description: 工单描述
- company: 关联的公司
- created_by: 创建者
- submitted_by: 提交者
- assigned_to: 分配的技术支持人员
- status: 工单状态
- priority: 优先级
- urgency: 紧急度
- category: 分类
- subcategory: 子分类
- ticket_type: 工单类型
- labels: 工单标签（多对多）
- followers: 关注人（多对多）
- ticket_url_slug: 工单URL标识
- contact_method: 联系方式
- contact_info: 联系信息
- created_at: 创建时间
- updated_at: 更新时间
- last_activity_at: 最后活动时间
- first_replied_at: 首次回复时间
- resolved_at: 解决时间
- closed_at: 关闭时间
- paused_at: 暂停时间
- pause_reason: 暂停原因
- closing_reason_type: 关闭原因类型
- closing_reason_detail: 关闭原因详情

### 7.7 工单回复模型 (TicketReply)

- id: 唯一标识符
- ticket: 关联的工单
- user: 回复用户
- content: 回复内容
- is_internal: 是否内部备注
- email_sent: 是否已发送邮件
- email_sent_at: 邮件发送时间
- created_at: 创建时间
- updated_at: 更新时间

### 7.8 工单状态历史模型 (TicketStatusHistory)

- id: 唯一标识符
- ticket: 关联的工单
- changed_by: 状态变更者
- old_status: 旧状态
- new_status: 新状态
- reason: 变更原因
- created_at: 创建时间

### 7.9 工单转移历史模型 (TicketTransferHistory)

- id: 唯一标识符
- ticket: 关联的工单
- transferred_by: 转移操作者
- transferred_from: 转移前的技术支持
- transferred_to: 转移后的技术支持
- reason: 转移原因
- created_at: 创建时间

### 7.10 附件模型 (Attachment)

- id: 唯一标识符
- file_name: 文件名
- file: 文件
- file_size: 文件大小
- file_type: 文件类型
- ticket: 关联的工单
- reply: 关联的回复
- uploaded_by: 上传者
- created_at: 创建时间

### 7.11 邮件模板模型 (EmailTemplate)

- id: 唯一标识符
- company: 关联的公司
- name: 模板名称
- template_type: 模板类型
- subject: 邮件主题
- content: 邮件内容
- created_at: 创建时间
- updated_at: 更新时间

### 7.12 Webhook模板模型 (WebhookTemplate)

- id: 唯一标识符
- company: 关联的公司
- name: 模板名称
- event_type: 事件类型
- url: Webhook URL
- headers: 请求头（JSON字段）
- payload_template: 请求体模板
- is_active: 是否激活
- created_at: 创建时间
- updated_at: 更新时间

## 8. 实施计划

### 8.1 开发阶段

1. **需求分析与设计**（2周）
   - 需求收集和分析
   - 系统架构设计
   - 数据库设计
   - UI/UX设计

2. **后端开发**（4周）
   - 数据模型实现
   - API开发
   - 权限系统实现
   - 业务逻辑实现

3. **前端开发**（4周）
   - 组件开发
   - 页面实现
   - 状态管理
   - API集成

4. **集成与测试**（2周）
   - 前后端集成
   - 单元测试
   - 集成测试
   - 性能测试

### 8.2 部署阶段

1. **环境准备**（1周）
   - 服务器配置
   - 数据库设置
   - 网络配置
   - 安全设置

2. **部署与配置**（1周）
   - 应用部署
   - 数据迁移
   - 系统配置
   - 监控设置

3. **上线与验收**（1周）
   - 系统上线
   - 用户培训
   - 验收测试
   - 问题修复

### 8.3 维护阶段

1. **运行维护**
   - 系统监控
   - 性能优化
   - 安全更新
   - 问题修复

2. **功能迭代**
   - 用户反馈收集
   - 新功能规划
   - 版本迭代
   - 持续优化

## 9. 风险与应对策略

### 9.1 技术风险

- **风险**：技术栈复杂度高，可能导致开发延期
- **应对**：合理规划开发阶段，优先实现核心功能，采用敏捷开发方法

### 9.2 安全风险

- **风险**：用户数据泄露或系统被攻击
- **应对**：实施严格的安全措施，定期安全审计，遵循安全最佳实践

### 9.3 用户接受度风险

- **风险**：用户不愿意使用新系统
- **应对**：提供详细的用户培训，收集用户反馈并及时改进，确保系统易用性

### 9.4 性能风险

- **风险**：系统在高负载下性能下降
- **应对**：进行性能测试和优化，实施缓存策略，准备扩展方案

## 10. 附录

### 10.1 术语表

- **SLA**：Service Level Agreement，服务级别协议
- **IR**：Initial Response，首次响应
- **Idle**：工单闲置状态
- **SSO**：Single Sign-On，单点登录
- **Webhook**：一种HTTP回调机制

### 10.2 状态码定义

- **new_issue**：新建工单
- **pending_assignment**：待分配
- **in_progress**：处理中
- **waiting_for_customer**：等待客户回复
- **customer_follow_up**：客户已回复
- **resolved**：已解决
- **closed**：已关闭
- **paused**：已暂停

### 10.3 API文档

详细的API文档请参考系统在线文档。
